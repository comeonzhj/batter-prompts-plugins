(()=>{"use strict";!function(){if(window.promptEnhancerInjected)return;window.promptEnhancerInjected=!0,console.log("提示词增强器注入脚本已加载"),window.promptEnhancerUtils={getPageText:()=>document.body.innerText||document.body.textContent||"",findElementByText:(e,t="*")=>{const s=`//${t}[contains(text(), '${e}')]`;return document.evaluate(s,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue},highlightElement:(e,t=2e3)=>{if(!e)return;const s=e.style.cssText;e.style.cssText+="; border: 2px solid #ff4444 !important; background-color: rgba(255, 68, 68, 0.1) !important;",setTimeout(()=>{e.style.cssText=s},t)},scrollToElement:(e,t="smooth")=>{e&&e.scrollIntoView({behavior:t,block:"center"})}};const e=new class{constructor(){this.init()}init(){window.addEventListener("message",e=>{e.source===window&&e.data.type&&e.data.type.startsWith("PROMPT_ENHANCER_")&&this.handleMessage(e.data)}),this.postMessage("INJECT_READY",{timestamp:Date.now()})}handleMessage(e){switch(e.type){case"PROMPT_ENHANCER_GET_REACT_FIBER":this.getReactFiber(e.selector,e.messageId);break;case"PROMPT_ENHANCER_TRIGGER_REACT_EVENT":this.triggerReactEvent(e.element,e.eventType,e.messageId);break;case"PROMPT_ENHANCER_GET_VUE_INSTANCE":this.getVueInstance(e.selector,e.messageId);break;default:console.warn("未知的注入脚本消息类型:",e.type)}}getReactFiber(e,t){try{const s=document.querySelector(e);if(!s)return void this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:"元素未找到"});const n=Object.keys(s).find(e=>e.startsWith("__reactInternalInstance")||e.startsWith("__reactFiber"));n?this.postMessage("INJECT_RESPONSE",{messageId:t,success:!0,data:{hasFiber:!0,fiberKey:n}}):this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:"React Fiber未找到"})}catch(e){this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:e.message})}}triggerReactEvent(e,t,s){try{const n=document.querySelector(e);if(!n)return void this.postMessage("INJECT_RESPONSE",{messageId:s,success:!1,error:"元素未找到"});const a=new Event(t,{bubbles:!0,cancelable:!0});Object.defineProperty(a,"target",{value:n,enumerable:!0}),n.dispatchEvent(a),this.postMessage("INJECT_RESPONSE",{messageId:s,success:!0,data:{eventTriggered:!0}})}catch(e){this.postMessage("INJECT_RESPONSE",{messageId:s,success:!1,error:e.message})}}getVueInstance(e,t){try{const s=document.querySelector(e);if(!s)return void this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:"元素未找到"});s.__vue__||s.__vueParentComponent?this.postMessage("INJECT_RESPONSE",{messageId:t,success:!0,data:{hasVue:!0}}):this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:"Vue实例未找到"})}catch(e){this.postMessage("INJECT_RESPONSE",{messageId:t,success:!1,error:e.message})}}postMessage(e,t){window.postMessage({type:`PROMPT_ENHANCER_${e}`,source:"inject-script",...t},"*")}},t=new class{constructor(){this.detectAndEnhance()}detectAndEnhance(){const e=window.location.hostname;e.includes("deepseek.com")?this.enhanceDeepSeek():e.includes("moonshot.cn")?this.enhanceKimi():e.includes("doubao.com")&&this.enhanceDoubao()}enhanceDeepSeek(){console.log("DeepSeek页面增强已启用"),this.observeInputChanges("#chat-input",(e,t)=>{})}enhanceKimi(){console.log("Kimi页面增强已启用"),this.observeInputChanges(".chat-input-editor",(e,t)=>{})}enhanceDoubao(){console.log("豆包页面增强已启用"),this.observeInputChanges('[data-testid="chat_input_input"]',(e,t)=>{})}observeInputChanges(e,t){const s=document.querySelector(e);s&&(new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type||"characterData"===e.type){const e=s.textContent||s.value||"";t(s,e)}})}).observe(s,{childList:!0,subtree:!0,characterData:!0}),s.addEventListener("input",()=>{const e=s.textContent||s.value||"";t(s,e)}))}};window.location.hash.includes("debug")&&(console.log("提示词增强器调试模式已启用"),window.promptEnhancerDebug={bridge:e,enhancements:t,utils:window.promptEnhancerUtils})}()})();